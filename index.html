<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Macro Oracle Dashboard v3.2 Â· Standalone</title>
<style>
:root{--bg:#0a0e17;--card:#131a2b;--border:#1e2a42;--text:#e0e6f0;--dim:#6b7d9e;--green:#00d68f;--red:#ff4757;--gold:#ffd700;--blue:#4da6ff;--orange:#ff9f43;--purple:#a855f7}
*{margin:0;padding:0;box-sizing:border-box}
body{background:var(--bg);color:var(--text);font-family:'SF Mono','Cascadia Code','Fira Code',monospace;font-size:13px;padding:12px}
h1{font-size:18px;color:var(--gold);margin-bottom:4px;letter-spacing:1px}
.sub{color:var(--dim);font-size:11px;margin-bottom:16px;display:flex;justify-content:space-between}
.dot{display:inline-block;width:8px;height:8px;border-radius:50%;margin-right:4px;animation:p 2s infinite}
.dot.ok{background:var(--green)}.dot.err{background:var(--red)}.dot.loading{background:var(--orange)}
@keyframes p{0%,100%{opacity:1}50%{opacity:0.3}}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(360px,1fr));gap:12px;margin-bottom:12px}
.card{background:var(--card);border:1px solid var(--border);border-radius:8px;padding:14px;transition:border-color .3s}
.card.flash{border-color:var(--gold)}
.ct{font-size:13px;font-weight:700;color:var(--blue);margin-bottom:10px;text-transform:uppercase;letter-spacing:.5px;border-bottom:1px solid var(--border);padding-bottom:6px;display:flex;justify-content:space-between;align-items:center}
.ct .src{font-size:9px;color:var(--dim);font-weight:400;text-transform:none}
table{width:100%;border-collapse:collapse}
th{text-align:left;color:var(--dim);font-size:11px;padding:3px 6px;font-weight:400}
td{padding:4px 6px;font-size:12px;border-top:1px solid rgba(30,42,66,.5)}
.v{font-weight:700;font-size:13px;transition:color .3s}
.up{color:var(--green)}.dn{color:var(--red)}.nt{color:var(--orange)}.gl{color:var(--gold)}.dm{color:var(--dim)}
.sig{display:inline-block;padding:2px 8px;border-radius:4px;font-size:10px;font-weight:700}
.sg{background:rgba(0,214,143,.15);color:var(--green)}
.sr{background:rgba(255,71,87,.15);color:var(--red)}
.sy{background:rgba(255,159,67,.15);color:var(--orange)}
.meter{height:6px;background:var(--border);border-radius:3px;overflow:hidden;margin:4px 0}
.meter-fill{height:100%;border-radius:3px;transition:width 1s}
.src-tag{font-size:9px;padding:1px 5px;border-radius:3px;cursor:pointer;text-decoration:none;margin-left:3px;transition:opacity .2s}
.src-tag:hover{opacity:.7}
.src-primary{background:rgba(77,166,255,.2);color:var(--blue)}
.src-verify{background:rgba(107,125,158,.2);color:var(--dim)}
.stale-badge{font-size:9px;padding:1px 4px;border-radius:3px;background:rgba(255,159,67,.2);color:var(--orange);margin-left:3px}
.fresh-badge{font-size:9px;padding:1px 4px;border-radius:3px;background:rgba(0,214,143,.15);color:var(--green);margin-left:3px}
.qb{display:grid;grid-template-columns:1fr 1fr;grid-template-rows:1fr 1fr;gap:4px;height:120px;margin:8px 0}
.qb div{display:flex;align-items:center;justify-content:center;border-radius:4px;font-size:11px;font-weight:700}
.q-tl{background:rgba(255,71,87,.12);color:var(--red)}
.q-tr{background:rgba(255,159,67,.12);color:var(--orange)}
.q-bl{background:rgba(77,166,255,.12);color:var(--blue)}
.q-br{background:rgba(0,214,143,.2);color:var(--green);border:2px solid var(--green)}
.score-bar{display:flex;align-items:center;gap:8px;margin:4px 0}
.score-label{width:70px;font-size:11px;color:var(--dim)}
.score-track{flex:1;height:8px;background:var(--border);border-radius:4px;overflow:hidden}
.score-fill{height:100%;border-radius:4px;transition:width 1s}
.score-num{width:30px;text-align:right;font-weight:700;font-size:12px}
.alert-box{background:rgba(255,71,87,.08);border:1px solid rgba(255,71,87,.3);border-radius:6px;padding:10px;margin:6px 0}
.alert-box .at{color:var(--red);font-weight:700;font-size:12px;margin-bottom:4px}
.opp-box{background:rgba(0,214,143,.08);border:1px solid rgba(0,214,143,.3);border-radius:6px;padding:10px;margin:6px 0}
.opp-box .at{color:var(--green);font-weight:700;font-size:12px;margin-bottom:4px}
.alert-banner{background:rgba(255,71,87,.15);border:1px solid var(--red);border-radius:6px;padding:8px 12px;margin-bottom:12px;font-size:11px;display:none}
.alert-banner.show{display:block}
a{color:inherit;text-decoration:none}
.proxy-note{background:rgba(77,166,255,.08);border:1px solid rgba(77,166,255,.3);border-radius:6px;padding:8px 12px;margin-bottom:12px;font-size:11px;color:var(--dim);display:none}
.proxy-note.show{display:block}
</style>
</head>
<body>

<h1>ğŸ”® MACRO ORACLE DASHBOARD <span style="font-size:11px;color:var(--dim)">v3.2 Â· Standalone</span></h1>
<div class="sub">
  <span><span class="dot loading" id="dot"></span> å…¨ç«™ç‹¬ç«‹ç‰ˆ Â· æ— éœ€æœ¬åœ°æœåŠ¡å™¨ Â· 60ç§’è‡ªåŠ¨åˆ·æ–° Â· <span id="ts">åŠ è½½ä¸­...</span></span>
  <span id="conn"></span>
</div>
<div class="alert-banner" id="banner"></div>
<div class="proxy-note" id="proxy-note">â„¹ï¸ è‚¡ç¥¨æ•°æ®é€šè¿‡ corsproxy.io ä¸­è½¬ï¼ˆYahoo Finance éœ€è¦ CORS ä»£ç†ï¼‰ã€‚å¦‚åŠ è½½å¤±è´¥å¯åˆ·æ–°é¡µé¢ã€‚</div>

<div class="grid">

<!-- æ ¸å¿ƒåˆ¤æ–­ -->
<div class="card" style="grid-column:span 2">
<div class="ct">ğŸ¯ æ ¸å¿ƒåˆ¤æ–­ + å®æ—¶ä»·æ ¼ <span class="src">å¤šæºèšåˆ | ç‚¹å‡»æ•°æ®æºå¯è·³è½¬åŸå§‹é¡µé¢</span></div>
<table>
<tr><th>èµ„äº§</th><th>å®æ—¶ä»·æ ¼</th><th>å˜åŠ¨</th><th>æ•°æ®æº</th><th>æ–¹å‘</th><th>ç½®ä¿¡åº¦</th><th>ç›®æ ‡</th><th>æ­¢æŸ</th></tr>
<tr><td class="v">S&P 500</td><td class="v" id="p-spx">â€”</td><td id="c-spx">â€”</td><td id="s-spx"></td><td class="up">BULL</td><td>3/5</td><td>7,000-7,200</td><td>6,500</td></tr>
<tr><td class="v gl">BTC â­</td><td class="v" id="p-btc">â€”</td><td id="c-btc">â€”</td><td id="s-btc"></td><td class="up">BULL</td><td>4/5</td><td>$85K-$100K</td><td>$58K</td></tr>
<tr><td class="v gl">é»„é‡‘ XAU</td><td class="v" id="p-gold">â€”</td><td id="c-gold">â€”</td><td id="s-gold"></td><td class="up">BULL</td><td>4/5</td><td>$5,200-$5,400</td><td>$4,700</td></tr>
<tr><td class="v">ç™½é“¶ XAG</td><td class="v" id="p-silver">â€”</td><td id="c-silver">â€”</td><td id="s-silver"></td><td class="up">BULL</td><td>3/5</td><td>$90-$95</td><td>$72</td></tr>
</table>
</div>

<!-- å¸‚åœºå¿«ç…§ -->
<div class="card">
<div class="ct">ğŸ“Š å¸‚åœºå¿«ç…§ <span class="src" id="snap-src">Yahoo Finance Â· CoinGecko</span></div>
<table>
<tr><th>èµ„äº§</th><th>ä»·æ ¼</th><th>å˜åŠ¨</th><th>æº</th><th></th></tr>
<tr><td>S&P 500</td><td class="v" id="m-spx">â€”</td><td id="mc-spx">â€”</td><td id="ms-spx"></td><td id="mf-spx"></td></tr>
<tr><td>Nasdaq</td><td class="v" id="m-ndx">â€”</td><td id="mc-ndx">â€”</td><td id="ms-ndx"></td><td id="mf-ndx"></td></tr>
<tr><td>Dow</td><td class="v" id="m-dow">â€”</td><td id="mc-dow">â€”</td><td id="ms-dow"></td><td id="mf-dow"></td></tr>
<tr><td>BTC</td><td class="v" id="m-btc">â€”</td><td id="mc-btc">â€”</td><td id="ms-btc"></td><td id="mf-btc"></td></tr>
<tr><td>é»„é‡‘</td><td class="v" id="m-gold">â€”</td><td id="mc-gold">â€”</td><td id="ms-gold"></td><td id="mf-gold"></td></tr>
<tr><td>ç™½é“¶</td><td class="v" id="m-silver">â€”</td><td id="mc-silver">â€”</td><td id="ms-silver"></td><td id="mf-silver"></td></tr>
<tr><td>WTI</td><td class="v" id="m-wti">â€”</td><td id="mc-wti">â€”</td><td id="ms-wti"></td><td id="mf-wti"></td></tr>
<tr><td>DXY</td><td class="v" id="m-dxy">â€”</td><td id="mc-dxy">â€”</td><td id="ms-dxy"></td><td id="mf-dxy"></td></tr>
<tr><td>VIX</td><td class="v" id="m-vix">â€”</td><td id="mc-vix">â€”</td><td id="ms-vix"></td><td id="mf-vix"></td></tr>
</table>
</div>

<!-- è¾¾åˆ©æ¬§å››è±¡é™ -->
<div class="card">
<div class="ct">ğŸ“ è¾¾åˆ©æ¬§å››è±¡é™</div>
<div class="qb">
  <div class="q-tl">æ»èƒ€åŒº<br>å¢é•¿â†“é€šèƒ€â†‘</div>
  <div class="q-tr">è¿‡çƒ­åŒº<br>å¢é•¿â†‘é€šèƒ€â†‘</div>
  <div class="q-bl">è¡°é€€åŒº<br>å¢é•¿â†“é€šèƒ€â†“</div>
  <div class="q-br">â—‰ é‡‘å‘å¥³å­©åŒº<br>å¢é•¿â†‘é€šèƒ€â†“</div>
</div>
<div style="font-size:11px;color:var(--dim)">å½“å‰ï¼šé‡‘å‘å¥³å­© â†’ è¿‡æ¸¡ä¸­ | ç½®ä¿¡åº¦ 3/5<br>ISMåˆ¶é€ ä¸š 52.6 â†‘ | æ ¸å¿ƒCPI 2.5% â†“ | éå†œ +130K</div>
</div>

<!-- åˆ©ç‡ -->
<div class="card">
<div class="ct">ğŸ¦ åˆ©ç‡ <span class="src">FRED + Yahoo Finance</span></div>
<table>
<tr><th>æŒ‡æ ‡</th><th>å€¼</th><th>ä¿¡å·</th><th>æº</th><th></th></tr>
<tr><td>Fed Funds</td><td class="v" id="r-ffr">â€”</td><td><span class="sig sy">æš‚åœæœŸ</span></td><td id="rs-ffr"></td><td id="rf-ffr"></td></tr>
<tr><td>2Y UST</td><td class="v" id="r-2y">â€”</td><td id="r-2y-s">â€”</td><td id="rs-2y"></td><td id="rf-2y"></td></tr>
<tr><td>10Y UST</td><td class="v" id="r-10y">â€”</td><td id="r-10y-s">â€”</td><td id="rs-10y"></td><td id="rf-10y"></td></tr>
<tr><td>30Y UST</td><td class="v" id="r-30y">â€”</td><td>â€”</td><td id="rs-30y"></td><td id="rf-30y"></td></tr>
<tr><td>2s10såˆ©å·®</td><td class="v" id="r-sp">â€”</td><td id="r-sp-s">â€”</td><td id="rs-sp"></td><td id="rf-sp"></td></tr>
<tr><td>5Y BEI</td><td class="v" id="r-bei">â€”</td><td>é€šèƒ€é¢„æœŸ</td><td id="rs-bei"></td><td id="rf-bei"></td></tr>
<tr><td>10Y TIPS</td><td class="v" id="r-tips">â€”</td><td>å®é™…åˆ©ç‡</td><td id="rs-tips"></td><td id="rf-tips"></td></tr>
</table>
</div>

<!-- ä¿¡ç”¨ -->
<div class="card">
<div class="ct">ğŸ›¡ï¸ ä¿¡ç”¨ & æ³¢åŠ¨ç‡ <span class="src">FRED + Yahoo</span></div>
<table>
<tr><th>æŒ‡æ ‡</th><th>å€¼</th><th>ä¿¡å·</th><th>æº</th><th></th></tr>
<tr><td>HYåˆ©å·®</td><td class="v" id="cr-hy">â€”</td><td id="cr-hy-s">â€”</td><td id="crs-hy"></td><td id="crf-hy"></td></tr>
<tr><td>IGåˆ©å·®</td><td class="v" id="cr-ig">â€”</td><td id="cr-ig-s">â€”</td><td id="crs-ig"></td><td id="crf-ig"></td></tr>
<tr><td>VIX</td><td class="v" id="cr-vix">â€”</td><td id="cr-vix-s">â€”</td><td id="crs-vix"></td><td id="crf-vix"></td></tr>
</table>
<div style="margin-top:8px">
<div style="font-size:11px;color:var(--dim)">ç³»ç»Ÿæ€§é£é™©è¯„åˆ†</div>
<div class="meter"><div class="meter-fill" id="risk-m" style="width:15%;background:var(--green)"></div></div>
<div style="font-size:11px;text-align:center;font-weight:700" id="risk-s">ä½é£é™©</div>
</div>
</div>

<!-- æµåŠ¨æ€§ -->
<div class="card">
<div class="ct">ğŸ’§ æµåŠ¨æ€§ <span class="src">FRED</span></div>
<table>
<tr><th>æŒ‡æ ‡</th><th>å€¼</th><th>ä¿¡å·</th><th>æº</th><th></th></tr>
<tr><td>Fedèµ„äº§è´Ÿå€ºè¡¨</td><td class="v" id="l-bs">â€”</td><td class="dn">QTä¸­</td><td id="ls-bs"></td><td id="lf-bs"></td></tr>
</table>
<div style="margin-top:8px;font-size:11px;color:var(--dim)">æµåŠ¨æ€§ç»¼åˆè¯„åˆ†</div>
<div class="meter"><div class="meter-fill" style="width:45%;background:var(--orange)"></div></div>
<div style="font-size:11px;text-align:center;color:var(--orange);font-weight:700">ä¸­æ€§åç´§ (45/100)</div>
</div>

<!-- BTC -->
<div class="card">
<div class="ct">â›“ï¸ BTC é“¾ä¸Š + æƒ…ç»ª <span class="src">CoinGecko + Alternative.me</span></div>
<table>
<tr><th>æŒ‡æ ‡</th><th>å€¼</th><th>ä¿¡å·</th><th>æº</th><th></th></tr>
<tr><td>BTC</td><td class="v" id="b-p">â€”</td><td id="b-p-s">â€”</td><td id="bs-p"></td><td id="bf-p"></td></tr>
<tr><td>24hå˜åŠ¨</td><td class="v" id="b-ch">â€”</td><td>â€”</td><td></td><td></td></tr>
<tr><td>æè´ªæŒ‡æ•°</td><td class="v" id="b-fg">â€”</td><td id="b-fg-s">â€”</td><td id="bs-fg"></td><td id="bf-fg"></td></tr>
<tr><td>MVRV</td><td class="v" id="b-mv">â€”</td><td id="b-mv-s">â€”</td><td id="bs-mv"></td><td id="bf-mv"></td></tr>
</table>
<div style="margin-top:10px;font-size:11px;color:var(--dim)">BTC å¤šç»´è¯„åˆ†</div>
<div class="score-bar"><span class="score-label">é“¾ä¸Š</span><div class="score-track"><div class="score-fill" style="width:80%;background:var(--green)"></div></div><span class="score-num up">8</span></div>
<div class="score-bar"><span class="score-label">æµåŠ¨æ€§</span><div class="score-track"><div class="score-fill" style="width:50%;background:var(--orange)"></div></div><span class="score-num">5</span></div>
<div class="score-bar"><span class="score-label">å‘¨æœŸ</span><div class="score-track"><div class="score-fill" style="width:60%;background:var(--blue)"></div></div><span class="score-num">6</span></div>
<div class="score-bar"><span class="score-label">æƒ…ç»ª</span><div class="score-track"><div class="score-fill" id="b-sb" style="width:90%;background:var(--green)"></div></div><span class="score-num up" id="b-sn">9</span></div>
<div class="score-bar"><span class="score-label">å®è§‚</span><div class="score-track"><div class="score-fill" style="width:50%;background:var(--orange)"></div></div><span class="score-num">5</span></div>
</div>

<!-- è´µé‡‘å± -->
<div class="card">
<div class="ct">ğŸ¥‡ è´µé‡‘å± <span class="src">Yahoo Finance</span></div>
<table>
<tr><th>æŒ‡æ ‡</th><th>å€¼</th><th>ä¿¡å·</th><th>æº</th><th></th></tr>
<tr><td>é»„é‡‘</td><td class="v gl" id="pm-g">â€”</td><td id="pm-g-s">â€”</td><td id="pms-g"></td><td id="pmf-g"></td></tr>
<tr><td>ç™½é“¶</td><td class="v gl" id="pm-s">â€”</td><td id="pm-s-s">â€”</td><td id="pms-s"></td><td id="pmf-s"></td></tr>
<tr><td>G/S Ratio</td><td class="v" id="pm-r">â€”</td><td>â€”</td><td></td><td></td></tr>
<tr><td>10Y TIPS</td><td class="v" id="pm-t">â€”</td><td>é»„é‡‘æ ¸å¿ƒé©±åŠ¨</td><td id="pms-t"></td><td></td></tr>
<tr><td>å¤®è¡Œè´­é‡‘</td><td class="v up">863å¨/å¹´</td><td>ç»“æ„æ€§éœ€æ±‚</td><td><a href="https://www.gold.org/goldhub/data/gold-demand-by-country" target="_blank" class="src-tag src-primary">WGC</a></td><td><span class="stale-badge">å­£åº¦</span></td></tr>
</table>
</div>

<!-- å‘Šè­¦ -->
<div class="card" style="grid-column:span 2">
<div class="ct">âš¡ å®æ—¶å‘Šè­¦ & é£é™©é›·è¾¾</div>
<div id="alerts-c"><div style="color:var(--dim);font-size:11px">åŠ è½½ä¸­...</div></div>
</div>

<!-- æ•°æ®è´¨é‡ -->
<div class="card">
<div class="ct">ğŸ” æ•°æ®è´¨é‡ç›‘æ§</div>
<div id="val-c"><div style="color:var(--dim);font-size:11px">ç­‰å¾…æ ¡éªŒ...</div></div>
</div>

<!-- Kill Switch -->
<div class="card">
<div class="ct">ğŸš¨ Kill Switch</div>
<table>
<tr><td class="dn">æ ¸å¿ƒCPI MoM &gt; 0.3%</td><td>â†’ å…¨é¢å‡ä»“</td><td id="ks-cpi">â€”</td></tr>
<tr><td class="dn">BTC &lt; $58,000</td><td>â†’ åˆ¤æ–­å¤±æ•ˆ</td><td id="ks-btc">â€”</td></tr>
<tr><td class="dn">HYåˆ©å·® &gt; 400bp</td><td>â†’ è½¬ä¸ºé˜²å¾¡</td><td id="ks-hy">â€”</td></tr>
<tr><td class="dn">VIX &gt; 35</td><td>â†’ ç³»ç»Ÿæ€§é£é™©</td><td id="ks-vix">â€”</td></tr>
<tr><td class="dn">DXY &gt; 105</td><td>â†’ æµåŠ¨æ€§å±æœº</td><td id="ks-dxy">â€”</td></tr>
</table>
</div>

</div>

<div style="text-align:center;color:var(--dim);font-size:10px;margin-top:8px">
  Macro Oracle v3.2 Standalone | FRED Â· Yahoo Finance Â· CoinGecko Â· Alternative.me | æ— éœ€æœ¬åœ°æœåŠ¡å™¨ | <span id="src-count"></span>
</div>

<script>
// â”€â”€â”€ é…ç½® â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const FRED_KEY = '4b63504ba634719bd7d6b678c8b996b8';
// Yahoo Finance éœ€è¦ CORS ä»£ç†ï¼ˆå®˜æ–¹ä¸å¼€æ”¾è·¨åŸŸï¼‰
const CORS_PROXY = 'https://corsproxy.io/?url=';
const YAHOO_BASE = 'https://query1.finance.yahoo.com/v8/finance/chart/';
const REFRESH_MS = 60000; // 60ç§’åˆ·æ–°

// â”€â”€â”€ æ•°æ®æºå®šä¹‰ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const SRC = {
  yahoo_spx:  { name:'Yahoo',      url:'https://finance.yahoo.com/quote/%5EGSPC',  freq:'å®æ—¶' },
  yahoo_ndx:  { name:'Yahoo',      url:'https://finance.yahoo.com/quote/%5EIXIC',  freq:'å®æ—¶' },
  yahoo_dow:  { name:'Yahoo',      url:'https://finance.yahoo.com/quote/%5EDJI',   freq:'å®æ—¶' },
  yahoo_vix:  { name:'Yahoo',      url:'https://finance.yahoo.com/quote/%5EVIX',   freq:'å®æ—¶' },
  yahoo_gold: { name:'Yahoo',      url:'https://finance.yahoo.com/quote/GC%3DF',   freq:'å®æ—¶' },
  yahoo_silver:{ name:'Yahoo',     url:'https://finance.yahoo.com/quote/SI%3DF',   freq:'å®æ—¶' },
  yahoo_wti:  { name:'Yahoo',      url:'https://finance.yahoo.com/quote/CL%3DF',   freq:'å®æ—¶' },
  yahoo_dxy:  { name:'Yahoo',      url:'https://finance.yahoo.com/quote/DX-Y.NYB', freq:'å®æ—¶' },
  yahoo_tnx:  { name:'Yahoo',      url:'https://finance.yahoo.com/quote/%5ETNX',   freq:'å®æ—¶' },
  yahoo_tyx:  { name:'Yahoo',      url:'https://finance.yahoo.com/quote/%5ETYX',   freq:'å®æ—¶' },
  fred_dff:   { name:'FRED',       url:'https://fred.stlouisfed.org/series/DFF',         freq:'æ¯æ—¥T+1' },
  fred_dgs2:  { name:'FRED',       url:'https://fred.stlouisfed.org/series/DGS2',        freq:'æ¯æ—¥T+1' },
  fred_dgs10: { name:'FRED',       url:'https://fred.stlouisfed.org/series/DGS10',       freq:'æ¯æ—¥T+1' },
  fred_t10y2y:{ name:'FRED',       url:'https://fred.stlouisfed.org/series/T10Y2Y',      freq:'æ¯æ—¥T+1' },
  fred_hy:    { name:'FRED',       url:'https://fred.stlouisfed.org/series/BAMLH0A0HYM2',freq:'æ¯æ—¥T+1' },
  fred_ig:    { name:'FRED',       url:'https://fred.stlouisfed.org/series/BAMLC0A4CBBB',freq:'æ¯æ—¥T+1' },
  fred_tips:  { name:'FRED',       url:'https://fred.stlouisfed.org/series/DFII10',      freq:'æ¯æ—¥T+1' },
  fred_bei:   { name:'FRED',       url:'https://fred.stlouisfed.org/series/T5YIE',       freq:'æ¯æ—¥T+1' },
  fred_walcl: { name:'FRED',       url:'https://fred.stlouisfed.org/series/WALCL',       freq:'æ¯å‘¨ä¸‰' },
  coingecko:  { name:'CoinGecko',  url:'https://www.coingecko.com/en/coins/bitcoin',     freq:'å®æ—¶' },
  alt_fg:     { name:'Alt.me',     url:'https://alternative.me/crypto/fear-and-greed-index/', freq:'æ¯æ—¥' },
  glassnode:  { name:'Glassnode',  url:'https://studio.glassnode.com/metrics?a=BTC&m=market.Mvrv', freq:'æ¯æ—¥' },
  cnbc_spx:   { name:'CNBC',       url:'https://www.cnbc.com/quotes/.SPX',            freq:'å®æ—¶',  role:'æ ¡éªŒ' },
  fred_sp500: { name:'FRED SP500', url:'https://fred.stlouisfed.org/series/SP500',    freq:'æ¯æ—¥T+1',role:'æ ¡éªŒ' },
  kitco:      { name:'Kitco',      url:'https://www.kitco.com/charts/livegold.html',  freq:'å®æ—¶',  role:'æ ¡éªŒ' },
  cboe_vix:   { name:'CBOE',       url:'https://www.cboe.com/tradable_products/vix/', freq:'å®æ—¶',  role:'æ ¡éªŒ' },
  coindesk:   { name:'CoinDesk',   url:'https://www.coindesk.com/price/bitcoin/',     freq:'å®æ—¶',  role:'æ ¡éªŒ' },
};

// â”€â”€â”€ å·¥å…·å‡½æ•° â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const fmt  = (n,d=2) => n!=null ? Number(n).toLocaleString('en-US',{minimumFractionDigits:d,maximumFractionDigits:d}) : 'â€”';
const chg  = (c,p)  => { if(!c||!p)return{t:'â€”',cl:'dm'};const r=((c-p)/p*100);return{t:(r>=0?'+':'')+r.toFixed(2)+'%',cl:r>=0?'up':'dn'};};
const sv   = (id,v,cls) => { const e=document.getElementById(id); if(!e)return; e.textContent=v; if(cls)e.className='v '+cls; };
const sh   = (id,h)     => { const e=document.getElementById(id); if(e)e.innerHTML=h; };
const safe = r => r.status==='fulfilled' ? r.value : null;

function srcTag(info) {
  if(!info)return '';
  const role = info.role==='æ ¡éªŒ'?'src-verify':'src-primary';
  return `<a href="${info.url||'#'}" target="_blank" class="src-tag ${role}" title="${info.freq||''}">${info.name}</a>`;
}
function srcTags(primary,verify){
  let h=srcTag(primary);
  if(verify&&verify.length)verify.forEach(v=>h+=srcTag({...v,role:'æ ¡éªŒ'}));
  return h;
}
function freshBadge(dateStr,freqType){
  if(!dateStr)return '<span class="stale-badge">æ— æ—¥æœŸ</span>';
  const d=new Date(dateStr),now=new Date(),diffH=(now-d)/3600000;
  if(freqType==='å®æ—¶')return diffH<0.083?'<span class="fresh-badge">å®æ—¶</span>':diffH<24?'<span class="fresh-badge">ä»Šæ—¥</span>':`<span class="stale-badge">â³${Math.floor(diffH/24)}å¤©å‰</span>`;
  if(freqType==='æ¯å‘¨')return diffH<168?'<span class="fresh-badge">æœ¬å‘¨</span>':`<span class="stale-badge">â³${Math.floor(diffH/24)}å¤©å‰</span>`;
  return diffH<48?'<span class="fresh-badge">æœ€æ–°</span>':`<span class="stale-badge">â³${Math.floor(diffH/24)}å¤©å‰</span>`;
}
function fredFresh(d){
  if(!d?.date)return '<span class="stale-badge">â€”</span>';
  const dt=new Date(d.date+'T00:00:00'),now=new Date(),diff=Math.floor((now-dt)/86400000);
  return diff<=2?`<span class="fresh-badge">${d.date}</span>`:`<span class="stale-badge">â³${d.date}(${diff}å¤©å‰)</span>`;
}

// â”€â”€â”€ API æ‹‰å–å‡½æ•° â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function fetchYahoo(symbol) {
  const rawUrl = `${YAHOO_BASE}${encodeURIComponent(symbol)}?interval=1d&range=2d&includeAdjustedClose=false`;

  const parseYahoo = d => {
    const meta = d?.chart?.result?.[0]?.meta;
    if(!meta?.regularMarketPrice) throw new Error('no price');
    return { price: meta.regularMarketPrice, prev_close: meta.previousClose ?? meta.chartPreviousClose ?? null };
  };

  // 1ï¸âƒ£ å…ˆå°è¯•ç›´è¿ï¼ˆéƒ¨åˆ†ç½‘ç»œ/æµè§ˆå™¨å¯è¡Œï¼‰
  try {
    const r = await fetch(rawUrl, {signal: AbortSignal.timeout(6000)});
    if(r.ok) { const d = await r.json(); return parseYahoo(d); }
  } catch(e) { /* CORS æˆ–è¶…æ—¶ â†’ é™çº§ */ }

  // 2ï¸âƒ£ corsproxy.io é™çº§
  try {
    const r = await fetch(CORS_PROXY + encodeURIComponent(rawUrl), {signal: AbortSignal.timeout(10000)});
    if(r.ok) { const d = await r.json(); return parseYahoo(d); }
  } catch(e2) { /* ä»£ç†ä¹Ÿå¤±è´¥ */ }

  // 3ï¸âƒ£ allorigins äºŒçº§é™çº§
  const r2 = await fetch(`https://api.allorigins.win/raw?url=${encodeURIComponent(rawUrl)}`, {signal: AbortSignal.timeout(10000)});
  if(!r2.ok) throw new Error(`Yahoo ${symbol}: all proxies failed`);
  return parseYahoo(await r2.json());
}

async function fetchFred(seriesId) {
  const url = `https://api.stlouisfed.org/fred/series/observations?series_id=${seriesId}&api_key=${FRED_KEY}&file_type=json&sort_order=desc&limit=1`;
  const r = await fetch(url);
  if(!r.ok) throw new Error(`FRED ${seriesId}: HTTP ${r.status}`);
  const d = await r.json();
  const obs = d.observations?.[0];
  if(!obs) throw new Error(`FRED ${seriesId}: no data`);
  return { value: obs.value==='.'?null:parseFloat(obs.value), date:obs.date };
}

async function fetchBTC() {
  const r = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=bitcoin&vs_currencies=usd&include_24hr_change=true&include_market_cap=true');
  if(!r.ok) throw new Error(`CoinGecko: HTTP ${r.status}`);
  const d = await r.json();
  const b = d?.bitcoin;
  return { price:b.usd, change_24h:parseFloat((b.usd_24h_change||0).toFixed(2)), market_cap:b.usd_market_cap };
}

async function fetchFG() {
  const r = await fetch('https://api.alternative.me/fng/?limit=1');
  if(!r.ok) throw new Error(`Alt.me: HTTP ${r.status}`);
  const d = await r.json();
  const item = d?.data?.[0];
  return { value:parseInt(item.value), label:item.value_classification, timestamp:item.timestamp };
}

// â”€â”€â”€ ä¸»æ•°æ®èšåˆ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function fetchAll() {
  const now = new Date().toISOString();
  const p = await Promise.allSettled([
    fetchYahoo('^GSPC'),    // 0 spx
    fetchYahoo('^IXIC'),    // 1 ndx
    fetchYahoo('^DJI'),     // 2 dow
    fetchYahoo('^VIX'),     // 3 vix
    fetchYahoo('GC=F'),     // 4 gold
    fetchYahoo('SI=F'),     // 5 silver
    fetchYahoo('CL=F'),     // 6 wti
    fetchYahoo('DX-Y.NYB'), // 7 dxy
    fetchYahoo('^TNX'),     // 8 tnx (10Y yield)
    fetchYahoo('^TYX'),     // 9 tyx (30Y yield)
    fetchFred('DFF'),           // 10
    fetchFred('DGS2'),          // 11
    fetchFred('DGS10'),         // 12
    fetchFred('T10Y2Y'),        // 13
    fetchFred('BAMLH0A0HYM2'),  // 14 hy spread
    fetchFred('BAMLC0A4CBBB'),  // 15 ig spread
    fetchFred('DFII10'),        // 16 tips
    fetchFred('T5YIE'),         // 17 bei
    fetchFred('WALCL'),         // 18 fed bs
    fetchBTC(),  // 19
    fetchFG(),   // 20
  ]);

  const spx=safe(p[0]),ndx=safe(p[1]),dow=safe(p[2]),vix=safe(p[3]),
        gold=safe(p[4]),silver=safe(p[5]),wti=safe(p[6]),dxy=safe(p[7]),
        tnx=safe(p[8]),tyx=safe(p[9]),
        fred_dff=safe(p[10]),fred_2y=safe(p[11]),fred_10y=safe(p[12]),
        fred_sp=safe(p[13]),fred_hy=safe(p[14]),fred_ig=safe(p[15]),
        fred_tips=safe(p[16]),fred_bei=safe(p[17]),fred_bs=safe(p[18]),
        btc=safe(p[19]),fg=safe(p[20]);

  const mk = (ydata, srcKey, verifySrcs) => ({
    price: ydata?.price ?? null,
    prev_close: ydata?.prev_close ?? null,
    primary: SRC[srcKey],
    verify: (verifySrcs||[]).map(k=>SRC[k]),
    fetched_at: now,
  });
  const mkF = (fd, srcKey, verifySrcs) => ({
    value: fd?.value ?? null,
    date: fd?.date ?? null,
    primary: SRC[srcKey],
    verify: (verifySrcs||[]).map(k=>SRC[k]),
    fetched_at: now,
  });

  const errors = p.filter(r=>r.status==='rejected').length;
  const data = {
    timestamp: now,
    sources: SRC,
    market: {
      sp500:   mk(spx,  'yahoo_spx',  ['cnbc_spx','fred_sp500']),
      nasdaq:  mk(ndx,  'yahoo_ndx',  []),
      dow:     mk(dow,  'yahoo_dow',  []),
    },
    rates: {
      fed_funds:    mkF(fred_dff,   'fred_dff',    []),
      ust_2y:       { ...mkF(fred_2y, 'fred_dgs2',['fred_dgs2']), yahoo: null },
      ust_10y:      { ...mkF(fred_10y,'fred_dgs10',[]), yahoo: tnx?.price ?? null },
      ust_30y:      { value:tyx?.price??null, primary:SRC.yahoo_tyx, verify:[], fetched_at:now },
      spread_2s10s: mkF(fred_sp,   'fred_t10y2y', []),
      tips_10y:     mkF(fred_tips, 'fred_tips',   []),
      bei_5y:       mkF(fred_bei,  'fred_bei',    []),
    },
    credit: {
      hy_spread: mkF(fred_hy, 'fred_hy', []),
      ig_spread: mkF(fred_ig, 'fred_ig', []),
      vix: { price:vix?.price??null, primary:SRC.yahoo_vix, verify:[SRC.cboe_vix], fetched_at:now },
    },
    crypto: {
      btc: btc ? {
        price:      btc.price,
        change_24h: btc.change_24h,
        market_cap: btc.market_cap,
        primary:    SRC.coingecko,
        verify:     [SRC.coindesk],
        fetched_at: now,
      } : { price:null, primary:SRC.coingecko, verify:[], fetched_at:now },
      fear_greed: fg ? {
        value: fg.value, label:fg.label,
        primary:SRC.alt_fg, verify:[], fetched_at:now,
      } : { value:null, primary:SRC.alt_fg, verify:[], fetched_at:now },
      mvrv: { value:null, error:'éœ€API key (å…è´¹æ³¨å†Œ glassnode.com)', primary:SRC.glassnode, verify:[], fetched_at:now },
    },
    commodities: {
      gold:   mk(gold,   'yahoo_gold',   ['kitco']),
      silver: mk(silver, 'yahoo_silver', []),
      wti:    mk(wti,    'yahoo_wti',    []),
    },
    fx: {
      dxy: { price:dxy?.price??null, primary:SRC.yahoo_dxy, verify:[], fetched_at:now },
    },
    liquidity: {
      fed_bs: mkF(fred_bs, 'fred_walcl', []),
    },
  };

  const alerts = buildAlerts(data);
  return { data, alerts, errors };
}

// â”€â”€â”€ å‘Šè­¦é€»è¾‘ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function buildAlerts(data) {
  const alerts = [];
  // 10Y: Yahoo vs FRED
  try {
    const yy=data.rates.ust_10y.yahoo, fy=data.rates.ust_10y.value;
    if(yy&&fy&&fy>0){const pct=Math.abs(yy-fy)/fy*100;if(pct>2)alerts.push({level:'WARNING',indicator:'10Y UST',msg:`10Yå›½å€ºæ”¶ç›Šç‡Yahoo(${yy}%) vs FRED(${fy}%) å·®å¼‚${pct.toFixed(1)}%`});}
  }catch(e){}
  // BTC range
  try { const b=data.crypto.btc.price; if(b&&(b<10000||b>500000))alerts.push({level:'CRITICAL',indicator:'BTC',msg:`BTCä»·æ ¼å¼‚å¸¸: $${b}`}); }catch(e){}
  // VIX range
  try { const v=data.credit.vix.price; if(v&&(v<5||v>90))alerts.push({level:'WARNING',indicator:'VIX',msg:`VIXå¼‚å¸¸å€¼: ${v}`}); }catch(e){}
  return alerts;
}

// â”€â”€â”€ æ¸²æŸ“ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function render(data, alerts, errors) {
  const now = data.timestamp;
  document.getElementById('ts').textContent = new Date(now).toLocaleString('zh-CN');
  document.getElementById('dot').className  = errors>8 ? 'dot err' : 'dot ok';
  const primary=Object.values(SRC).filter(s=>!s.role).length;
  const verify =Object.values(SRC).filter(s=>s.role).length;
  sh('src-count',`${primary}ä¸ªä¸»æº + ${verify}ä¸ªæ ¡éªŒæº | æœ¬æ¬¡å¤±è´¥è¯·æ±‚: ${errors}`);
  if(errors>0)document.getElementById('proxy-note').className='proxy-note show';

  // â”€â”€ Market â”€â”€
  [['sp500','spx'],['nasdaq','ndx'],['dow','dow']].forEach(([key,pre])=>{
    const o=data.market[key];
    if(!o?.price)return;
    const c=chg(o.price,o.prev_close);
    sv('m-'+pre,fmt(o.price),c.cl); sh('mc-'+pre,`<span class="${c.cl}">${c.t}</span>`);
    sh('ms-'+pre,srcTags(o.primary,o.verify)); sh('mf-'+pre,freshBadge(o.fetched_at,'å®æ—¶'));
    if(pre==='spx'){sv('p-spx',fmt(o.price),c.cl);sh('c-spx',`<span class="${c.cl}">${c.t}</span>`);sh('s-spx',srcTags(o.primary,o.verify));}
  });

  // â”€â”€ BTC â”€â”€
  const btc=data.crypto.btc;
  if(btc?.price){
    const c24=btc.change_24h||0,cl=c24>=0?'up':'dn';
    sv('p-btc','$'+fmt(btc.price),cl); sh('c-btc',`<span class="${cl}">${c24>=0?'+':''}${fmt(c24)}%</span>`); sh('s-btc',srcTags(btc.primary,btc.verify));
    sv('m-btc','$'+fmt(btc.price),cl); sh('mc-btc',`<span class="${cl}">${c24>=0?'+':''}${fmt(c24)}%</span>`); sh('ms-btc',srcTags(btc.primary,btc.verify)); sh('mf-btc',freshBadge(btc.fetched_at,'å®æ—¶'));
    sv('b-p','$'+fmt(btc.price)); sh('b-p-s','å®æ—¶'); sh('bs-p',srcTags(btc.primary,btc.verify)); sh('bf-p',freshBadge(btc.fetched_at,'å®æ—¶'));
    sv('b-ch',(c24>=0?'+':'')+fmt(c24)+'%',cl);
    sv('ks-btc',btc.price<58000?'ğŸ”´ è§¦å‘!':'âœ… $'+fmt(btc.price,0),btc.price<58000?'dn':'up');
  }

  // â”€â”€ Gold / Silver â”€â”€
  const gold=data.commodities.gold,silver=data.commodities.silver;
  if(gold?.price){
    const c=chg(gold.price,gold.prev_close);
    sv('p-gold','$'+fmt(gold.price),c.cl); sh('c-gold',`<span class="${c.cl}">${c.t}</span>`); sh('s-gold',srcTags(gold.primary,gold.verify));
    sv('m-gold','$'+fmt(gold.price),'gl'); sh('mc-gold',`<span class="${c.cl}">${c.t}</span>`); sh('ms-gold',srcTags(gold.primary,gold.verify)); sh('mf-gold',freshBadge(gold.fetched_at,'å®æ—¶'));
    sv('pm-g','$'+fmt(gold.price)); sh('pm-g-s',c.t); sh('pms-g',srcTags(gold.primary,gold.verify)); sh('pmf-g',freshBadge(gold.fetched_at,'å®æ—¶'));
  }
  if(silver?.price){
    const c=chg(silver.price,silver.prev_close);
    sv('p-silver','$'+fmt(silver.price),c.cl); sh('c-silver',`<span class="${c.cl}">${c.t}</span>`); sh('s-silver',srcTags(silver.primary,silver.verify));
    sv('m-silver','$'+fmt(silver.price),'gl'); sh('mc-silver',`<span class="${c.cl}">${c.t}</span>`); sh('ms-silver',srcTags(silver.primary,silver.verify)); sh('mf-silver',freshBadge(silver.fetched_at,'å®æ—¶'));
    sv('pm-s','$'+fmt(silver.price)); sh('pm-s-s',c.t); sh('pms-s',srcTags(silver.primary,silver.verify)); sh('pmf-s',freshBadge(silver.fetched_at,'å®æ—¶'));
  }
  if(gold?.price&&silver?.price&&silver.price>0)sv('pm-r',fmt(gold.price/silver.price,1)+'x');

  // â”€â”€ WTI / DXY â”€â”€
  const wti=data.commodities.wti,dxy=data.fx.dxy;
  if(wti?.price){const c=chg(wti.price,wti.prev_close);sv('m-wti','$'+fmt(wti.price),c.cl);sh('mc-wti',`<span class="${c.cl}">${c.t}</span>`);sh('ms-wti',srcTags(wti.primary,wti.verify));sh('mf-wti',freshBadge(wti.fetched_at,'å®æ—¶'));}
  if(dxy?.price){sv('m-dxy',fmt(dxy.price));sh('mc-dxy','ICE DXY');sh('ms-dxy',srcTags(dxy.primary,dxy.verify));sh('mf-dxy',freshBadge(dxy.fetched_at,'å®æ—¶'));sv('ks-dxy',dxy.price>105?'ğŸ”´ è§¦å‘!':'âœ… '+fmt(dxy.price),dxy.price>105?'dn':'up');}

  // â”€â”€ VIX â”€â”€
  const vv=data.credit.vix;
  if(vv?.price){
    const v=vv.price;
    sv('m-vix',fmt(v),v>25?'dn':v>20?'nt':'up'); sh('mc-vix',v<20?'ä½æ³¢åŠ¨':v<25?'ä¸­æ€§':'é«˜æ³¢åŠ¨'); sh('ms-vix',srcTags(vv.primary,vv.verify)); sh('mf-vix',freshBadge(vv.fetched_at,'å®æ—¶'));
    sv('cr-vix',fmt(v)); sh('cr-vix-s',v<20?'<span class="sig sg">ä½æ³¢åŠ¨</span>':v<25?'<span class="sig sy">ä¸­æ€§</span>':'<span class="sig sr">é«˜æ³¢åŠ¨</span>'); sh('crs-vix',srcTags(vv.primary,vv.verify)); sh('crf-vix',freshBadge(vv.fetched_at,'å®æ—¶'));
    sv('ks-vix',v>35?'ğŸ”´ è§¦å‘!':'âœ… '+fmt(v),v>35?'dn':'up');
  }

  // â”€â”€ Rates â”€â”€
  const r=data.rates;
  if(r.fed_funds?.value!=null){sv('r-ffr',r.fed_funds.value+'%');sh('rs-ffr',srcTags(r.fed_funds.primary,r.fed_funds.verify));sh('rf-ffr',fredFresh(r.fed_funds));}
  if(r.ust_2y){const v=r.ust_2y.value;if(v)sv('r-2y',fmt(v)+'%');sh('r-2y-s',v&&r.fed_funds?.value&&v<r.fed_funds.value?'ä½äºFFR':'');sh('rs-2y',srcTags(r.ust_2y.primary,r.ust_2y.verify));sh('rf-2y',fredFresh(r.ust_2y));}
  if(r.ust_10y){const v=r.ust_10y.yahoo||r.ust_10y.value;if(v)sv('r-10y',fmt(v)+'%');sh('rs-10y',srcTags(r.ust_10y.primary,r.ust_10y.verify));sh('rf-10y',fredFresh(r.ust_10y));}
  if(r.ust_30y?.value)sv('r-30y',fmt(r.ust_30y.value)+'%');if(r.ust_30y)sh('rs-30y',srcTags(r.ust_30y.primary,r.ust_30y.verify));
  if(r.spread_2s10s?.value!=null){const s=r.spread_2s10s.value;sv('r-sp',(s>=0?'+':'')+fmt(s)+'%',s>=0?'up':'dn');sh('r-sp-s',s>=0?'æ­£æ–œç‡âœ…':'å€’æŒ‚âš ï¸');sh('rs-sp',srcTags(r.spread_2s10s.primary,r.spread_2s10s.verify));sh('rf-sp',fredFresh(r.spread_2s10s));}
  if(r.bei_5y?.value){sv('r-bei',fmt(r.bei_5y.value)+'%');sh('rs-bei',srcTags(r.bei_5y.primary,r.bei_5y.verify));sh('rf-bei',fredFresh(r.bei_5y));}
  if(r.tips_10y?.value!=null){sv('r-tips',fmt(r.tips_10y.value)+'%');sh('rs-tips',srcTags(r.tips_10y.primary,r.tips_10y.verify));sh('rf-tips',fredFresh(r.tips_10y));sv('pm-t',fmt(r.tips_10y.value)+'%');sh('pms-t',srcTags(r.tips_10y.primary,r.tips_10y.verify));}

  // â”€â”€ Credit â”€â”€
  const cr=data.credit;
  const hy=cr.hy_spread?.value;
  if(hy!=null){const bp=Math.round(hy*100);sv('cr-hy',bp+'bp',bp<350?'up':'dn');sh('cr-hy-s',bp<500?'<span class="sig sg">å®‰å…¨</span>':'<span class="sig sr">å‹åŠ›</span>');sh('crs-hy',srcTags(cr.hy_spread.primary,cr.hy_spread.verify));sh('crf-hy',fredFresh(cr.hy_spread));sv('ks-hy',bp>400?'ğŸ”´ è§¦å‘!':'âœ… '+bp+'bp',bp>400?'dn':'up');}
  const ig=cr.ig_spread?.value;
  if(ig!=null){const bp=Math.round(ig*100);sv('cr-ig',bp+'bp',bp<150?'up':'nt');sh('cr-ig-s',bp<200?'<span class="sig sg">å®‰å…¨</span>':'<span class="sig sr">å‹åŠ›</span>');sh('crs-ig',srcTags(cr.ig_spread.primary,cr.ig_spread.verify));sh('crf-ig',fredFresh(cr.ig_spread));}

  // â”€â”€ Fear & Greed â”€â”€
  const fg=data.crypto.fear_greed;
  if(fg?.value!=null){sv('b-fg',fg.value+' ('+(fg.label||'')+')',fg.value<25?'dn':fg.value>75?'up':'nt');sh('b-fg-s','å®æ—¶');sh('bs-fg',srcTags(fg.primary,fg.verify));sh('bf-fg',freshBadge(fg.fetched_at,'æ¯æ—¥'));const sn=fg.value<15?9:fg.value<25?8:fg.value<40?6:5;document.getElementById('b-sb').style.width=sn*10+'%';document.getElementById('b-sn').textContent=sn;}

  // â”€â”€ MVRV â”€â”€
  const mv=data.crypto.mvrv;
  if(mv){sv('b-mv',mv.value?fmt(mv.value,4):(mv.error||'â€”'),mv.value&&mv.value<1.5?'up':'dm');sh('b-mv-s',mv.value?'å®æ—¶':'âš ï¸ éœ€API key');sh('bs-mv',srcTags(mv.primary,mv.verify));sh('bf-mv',mv.value?freshBadge(mv.fetched_at,'æ¯æ—¥'):'<span class="stale-badge">æœªæ¥å…¥</span>');}

  // â”€â”€ Fed Balance Sheet â”€â”€
  if(data.liquidity?.fed_bs?.value){const bs=data.liquidity.fed_bs.value/1000000;sv('l-bs','$'+fmt(bs,3)+'T');sh('ls-bs',srcTags(data.liquidity.fed_bs.primary,data.liquidity.fed_bs.verify));sh('lf-bs',fredFresh(data.liquidity.fed_bs));}

  // â”€â”€ Risk Meter â”€â”€
  let rs=15;const vvp=vv?.price;if(vvp>25)rs+=20;if(vvp>35)rs+=30;const hyp=cr.hy_spread?.value;if(hyp&&hyp>4)rs+=25;
  document.getElementById('risk-m').style.width=rs+'%';document.getElementById('risk-m').style.background=rs<30?'var(--green)':rs<60?'var(--orange)':'var(--red)';
  document.getElementById('risk-s').textContent=(rs<30?'ä½é£é™©':rs<60?'ä¸­é£é™©':'é«˜é£é™©')+' ('+rs+'/100)';document.getElementById('risk-s').style.color=rs<30?'var(--green)':rs<60?'var(--orange)':'var(--red)';

  // â”€â”€ Alerts â”€â”€
  let ah='';
  ah+='<div class="opp-box"><div class="at">ğŸŸ¢ æœ€å¤§éå¯¹ç§°æœºä¼šï¼šBTC</div><div style="font-size:11px">æè´ªæä½ + é“¾ä¸Šæåº¦ä½ä¼° = å†å²çº§é€†å‘ä¿¡å·</div></div>';
  ah+='<div class="alert-box"><div class="at">âš ï¸ ä¼ ç»ŸæŒ‡æ ‡é›†ä½“å¤±æ•ˆ</div><div style="font-size:11px">æœºæ„åŒ–æ”¹å˜BTCå¸‚åœºç»“æ„ã€‚æé«˜ETFæµé‡+å®è§‚æµåŠ¨æ€§æƒé‡ã€‚</div></div>';
  if(alerts.length){
    document.getElementById('banner').className='alert-banner show';
    document.getElementById('banner').innerHTML='ğŸš¨ '+alerts.map(a=>a.msg).join(' | ');
    alerts.forEach(a=>ah+=`<div class="alert-box"><div class="at">ğŸ”´ ${a.level}: ${a.indicator}</div><div style="font-size:11px">${a.msg}</div></div>`);
  } else {document.getElementById('banner').className='alert-banner';}
  sh('alerts-c',ah);

  // â”€â”€ Val â”€â”€
  sh('val-c',`<div style="font-size:11px;color:var(--green)">âœ… æ•°æ®æ ¡éªŒ | ${alerts.length}æ¡å‘Šè­¦ | ${errors}æ¬¡APIå¤±è´¥ | æ— éœ€æœ¬åœ°æœåŠ¡å™¨</div><div style="font-size:10px;color:var(--dim);margin-top:4px">æ•°æ®æº: FRED Â· Yahoo Finance(via corsproxy.io) Â· CoinGecko Â· Alternative.me | 60ç§’è‡ªåŠ¨åˆ·æ–°</div>`);

  sh('conn',`<span style="color:${errors>8?'var(--red)':'var(--green)'}">â— ${errors>8?'éƒ¨åˆ†ç¦»çº¿':'åœ¨çº¿'}</span>`);
}

// â”€â”€â”€ ä¸»å¾ªç¯ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function poll() {
  try {
    document.getElementById('dot').className = 'dot loading';
    const {data,alerts,errors} = await fetchAll();
    render(data, alerts, errors);
  } catch(e) {
    document.getElementById('dot').className = 'dot err';
    sh('conn','<span style="color:var(--red)">â— ç¦»çº¿</span>');
    sh('val-c',`<div style="font-size:11px;color:var(--red)">âŒ æ•°æ®æ‹‰å–å¤±è´¥: ${e.message}</div>`);
    console.error('[Macro Oracle]', e);
  }
}

poll();
setInterval(poll, REFRESH_MS);
</script>
</body>
</html>
